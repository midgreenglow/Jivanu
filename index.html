<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Northeast Donor Program: Interactive Blueprint</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Chosen Palette: Earthy Harmony -->
    <!-- Application Structure Plan: The application is designed as a single-page dashboard, moving away from the linear structure of the source report. This thematic, non-linear layout allows a project manager to quickly access specific, task-oriented information. The structure includes: 1) A high-level summary. 2) A 'Why Northeast?' section for foundational rationale, using interactive cards and a chart for quick comprehension. 3) An interactive 'Strategic Plan' with a state-selector to dynamically display targeted information. 4) A visual, collapsible 'Itinerary' timeline for clear process overview. 5) An AI-powered 'Strategic Insights' section for dynamic idea generation. 6) A filterable 'Resources' table with an integrated AI email drafting tool. This user-centric design prioritizes quick data retrieval, synthesis, and generative assistance for key project management tasks. -->
    <!-- Visualization & Content Choices: Report Info -> Goal -> Viz/Presentation -> Interaction -> Justification -> Library/Method. 1) Regional Athleticism -> Compare sport prominence -> Bar Chart -> Hover for details -> Provides a quick visual comparison of target sports' focus across states -> Chart.js/Canvas. 2) State-specific plans -> Organize & Inform -> Interactive Button Group + Dynamic Text Blocks -> Click state to update details -> Allows users to focus on one state's complete plan at a time -> Vanilla JS. 3) Pilot Program Timeline -> Show Change/Process -> Interactive Timeline (HTML/CSS) -> Click to expand details -> Clearly visualizes the phased rollout -> Vanilla JS. 4) Strategic Ideas -> Generate new content -> Text Input + Dynamic Text Output -> Ask questions to get new ideas -> Provides a powerful generative assistant for strategic planning -> Gemini API/Vanilla JS. 5) List of Academies & Outreach -> Organize & Communicate -> Interactive Table + AI-powered modal -> Dropdown filters, click to generate email draft -> Enables rapid searching and communication with potential partners -> Vanilla JS/Gemini API. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #FDFBF7;
            color: #1a202c;
        }
        .nav-link {
            transition: color 0.3s ease, border-bottom-color 0.3s ease;
            border-bottom: 2px solid transparent;
        }
        .nav-link:hover, .nav-link.active {
            color: #004D40;
            border-bottom-color: #004D40;
        }
        .state-selector.active {
            background-color: #004D40 !important;
            color: #ffffff !important;
            box-shadow: 0 4px 14px 0 rgba(0, 77, 64, 0.39);
        }
        .timeline-item::before {
            content: '';
            position: absolute;
            left: -10px;
            top: 50%;
            transform: translateY(-50%);
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background-color: #D4AF37;
            border: 3px solid #FDFBF7;
            z-index: 1;
        }
        .timeline-line {
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 4px;
            background-color: #e2e8f0;
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
            height: 400px;
            max-height: 50vh;
        }
        .gemini-loading {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #004D40;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="antialiased">

    <header class="bg-white/80 backdrop-blur-lg sticky top-0 z-50 shadow-sm">
        <nav class="container mx-auto px-6 py-4 flex justify-between items-center">
            <h1 class="text-xl md:text-2xl font-bold text-[#004D40]">Northeast Donor Program</h1>
            <div class="hidden md:flex space-x-8">
                <a href="#why-ne" class="nav-link font-medium text-gray-600 pb-1">The 'Why'</a>
                <a href="#strategy" class="nav-link font-medium text-gray-600 pb-1">Strategy</a>
                <a href="#itinerary" class="nav-link font-medium text-gray-600 pb-1">Itinerary</a>
                <a href="#insights" class="nav-link font-medium text-gray-600 pb-1">Insights</a>
                <a href="#resources" class="nav-link font-medium text-gray-600 pb-1">Resources</a>
            </div>
            <div class="md:hidden">
                <select id="mobile-nav" class="bg-gray-100 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-[#004D40] focus:border-[#004D40] block w-full p-2.5">
                    <option value="#why-ne">The 'Why'</option>
                    <option value="#strategy">Strategy</option>
                    <option value="#itinerary">Itinerary</option>
                    <option value="#insights">Insights</option>
                    <option value="#resources">Resources</option>
                </select>
            </div>
        </nav>
    </header>

    <main>
        <section id="hero" class="py-16 md:py-24 bg-white">
            <div class="container mx-auto px-6 text-center">
                <h2 class="text-3xl md:text-5xl font-bold text-gray-800 mb-4">Finding India's 'Super Donors'</h2>
                <p class="text-lg md:text-xl text-gray-600 max-w-3xl mx-auto">
                    Strategic pilot program in Northeast India, targeting elite athletes with superior gut microbiomes shaped by a unique synergy of traditional diet and lifelong athleticism.
                </p>
            </div>
        </section>

        <section id="why-ne" class="py-16 md:py-20">
            <div class="container mx-auto px-6">
                <div class="text-center mb-12">
                    <h3 class="text-3xl md:text-4xl font-bold text-gray-800">Why Northeast India?</h3>
                    <p class="mt-4 text-lg text-gray-600 max-w-3xl mx-auto">The region presents a unique confluence of two critical factors for a healthy gut microbiome: a pristine diet and a deep-rooted culture of athleticism.</p>
                </div>

                <div class="grid md:grid-cols-2 gap-12 items-center">
                    <div>
                        <h4 class="text-2xl font-semibold text-gray-700 mb-6">The Dietary Advantage</h4>
                        <div class="space-y-4">
                            <div class="p-4 bg-white rounded-lg shadow-sm flex items-center">
                                <span class="text-2xl mr-4">üç≤</span>
                                <div>
                                    <h5 class="font-semibold">Minimal Oil & Spices</h5>
                                    <p class="text-gray-600 text-sm">Cuisine across the region favors boiling and steaming over frying, promoting better digestive health.</p>
                                </div>
                            </div>
                            <div class="p-4 bg-white rounded-lg shadow-sm flex items-center">
                                <span class="text-2xl mr-4">üåø</span>
                                <div>
                                    <h5 class="font-semibold">Rich in Fermented Foods</h5>
                                    <p class="text-gray-600 text-sm">Staples like fermented bamboo, soybeans (Akhuni), and fish (Ngari) are rich in probiotics.</p>
                                </div>
                            </div>
                            <div class="p-4 bg-white rounded-lg shadow-sm flex items-center">
                                <span class="text-2xl mr-4">üêü</span>
                                <div>
                                    <h5 class="font-semibold">Locally Sourced & Indigenous</h5>
                                    <p class="text-gray-600 text-sm">Diets rely on fresh, foraged greens, river fish, and wild herbs, ensuring high nutrient density.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div>
                        <h4 class="text-2xl font-semibold text-gray-700 mb-6">A Culture of Athleticism</h4>
                        <p class="text-gray-600 mb-4">The Northeast is a powerhouse of sporting talent, producing national and international champions, particularly in strength and endurance sports. This chart highlights the regional focus on disciplines that align with our donor criteria.</p>
                        <div class="chart-container bg-white p-4 rounded-lg shadow-md">
                            <canvas id="sportsChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section id="strategy" class="py-16 md:py-20 bg-white">
            <div class="container mx-auto px-6">
                <div class="text-center mb-12">
                    <h3 class="text-3xl md:text-4xl font-bold text-gray-800">Strategic Plan</h3>
                    <p class="mt-4 text-lg text-gray-600 max-w-3xl mx-auto">Our phased approach focuses on states with the highest concentration of elite athletes and institutional support. Select a state to explore the targeted strategy.</p>
                </div>

                <div class="flex flex-col md:flex-row gap-8">
                    <div class="md:w-1/3">
                        <div id="state-selector-container" class="flex flex-row md:flex-col gap-2 flex-wrap">
                        </div>
                    </div>
                    <div id="strategy-details" class="md:w-2/3 bg-[#FDFBF7] p-6 rounded-lg shadow-inner min-h-[300px]">
                    </div>
                </div>
            </div>
        </section>

        <section id="itinerary" class="py-16 md:py-20">
            <div class="container mx-auto px-6">
                <div class="text-center mb-12">
                    <h3 class="text-3xl md:text-4xl font-bold text-gray-800">Proposed 6-Week Pilot Itinerary</h3>
                    <p class="mt-4 text-lg text-gray-600 max-w-3xl mx-auto">A phased itinerary to optimize resource allocation and ensure successful engagement across primary and secondary hubs. Click on each phase to see details.</p>
                </div>

                <div id="timeline-container" class="relative max-w-3xl mx-auto">
                    <div class="timeline-line"></div>
                </div>
            </div>
        </section>

        <section id="insights" class="py-16 md:py-20 bg-white">
            <div class="container mx-auto px-6">
                <div class="text-center mb-12">
                    <h3 class="text-3xl md:text-4xl font-bold text-gray-800">Strategic Insights ‚ú®</h3>
                    <p class="mt-4 text-lg text-gray-600 max-w-3xl mx-auto">Use AI to generate new ideas for your program. Ask for new sports to target, alternative cities, or potential collaborations.</p>
                </div>
                <div class="max-w-3xl mx-auto bg-[#FDFBF7] p-6 rounded-lg shadow-inner">
                    <div class="flex flex-col md:flex-row gap-4 mb-4">
                        <input type="text" id="insight-prompt" placeholder="E.g., What are other sports to target in Meghalaya?" class="flex-1 p-3 rounded-lg border border-gray-300 focus:ring-[#004D40] focus:border-[#004D40]">
                        <button id="generate-insight-btn" class="bg-[#004D40] text-white font-semibold py-3 px-6 rounded-lg hover:bg-[#003B2E] transition-colors duration-300 flex items-center justify-center">
                            Generate Insight ‚ú®
                        </button>
                    </div>
                    <div id="insight-loading" class="hidden flex items-center justify-center py-4">
                        <div class="gemini-loading"></div>
                    </div>
                    <div id="insight-output" class="p-4 bg-white rounded-lg border border-gray-200 min-h-[100px] text-gray-800">
                        <p class="text-gray-500 italic">Insights will appear here...</p>
                    </div>
                </div>
            </div>
        </section>

        <section id="resources" class="py-16 md:py-20">
            <div class="container mx-auto px-6">
                <div class="text-center mb-12">
                    <h3 class="text-3xl md:text-4xl font-bold text-gray-800">Resources: Key Academies & Centers</h3>
                    <p class="mt-4 text-lg text-gray-600 max-w-3xl mx-auto">A database of potential recruitment partners. Use the filters to narrow down institutions by state and primary sport.</p>
                </div>

                <div class="flex flex-col md:flex-row gap-4 mb-6 bg-gray-50 p-4 rounded-lg">
                    <div class="flex-1">
                        <label for="state-filter" class="block mb-2 text-sm font-medium text-gray-900">Filter by State</label>
                        <select id="state-filter" class="bg-white border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-[#004D40] focus:border-[#004D40] block w-full p-2.5">
                            <option selected value="All">All States</option>
                        </select>
                    </div>
                    <div class="flex-1">
                        <label for="sport-filter" class="block mb-2 text-sm font-medium text-gray-900">Filter by Sport</label>
                        <select id="sport-filter" class="bg-white border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-[#004D40] focus:border-[#004D40] block w-full p-2.5">
                            <option selected value="All">All Sports</option>
                        </select>
                    </div>
                </div>

                <div class="overflow-x-auto bg-white rounded-lg shadow">
                    <table class="w-full text-sm text-left text-gray-500">
                        <thead class="text-xs text-gray-700 uppercase bg-gray-50">
                            <tr>
                                <th scope="col" class="px-6 py-3">Name</th>
                                <th scope="col" class="px-6 py-3">State</th>
                                <th scope="col" class="px-6 py-3">Primary Sports</th>
                                <th scope="col" class="px-6 py-3">City</th>
                                <th scope="col" class="px-6 py-3">Outreach</th>
                            </tr>
                        </thead>
                        <tbody id="academies-table-body">
                        </tbody>
                    </table>
                </div>
            </div>
        </section>
        
        <div id="email-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 hidden items-center justify-center p-4 z-50">
            <div class="bg-white p-6 rounded-lg shadow-xl w-full max-w-2xl">
                <h4 class="text-xl font-bold text-gray-800 mb-4">Generate Outreach Email ‚ú®</h4>
                <div class="mb-4">
                    <label for="contact-name" class="block text-sm font-medium text-gray-700 mb-1">Contact Person Name (Optional)</label>
                    <input type="text" id="contact-name" class="w-full p-2 border rounded-lg">
                </div>
                <div class="mb-4">
                    <label for="custom-notes" class="block text-sm font-medium text-gray-700 mb-1">Custom Notes (Optional)</label>
                    <textarea id="custom-notes" rows="2" class="w-full p-2 border rounded-lg"></textarea>
                </div>
                <div id="email-loading" class="hidden flex items-center justify-center py-4">
                    <div class="gemini-loading"></div>
                </div>
                <div id="email-output" class="mb-4">
                    <textarea id="email-draft" rows="10" class="w-full p-3 border rounded-lg bg-gray-50 font-mono text-sm" readonly>Draft will appear here...</textarea>
                </div>
                <div class="flex justify-end gap-2">
                    <button id="copy-email-btn" class="bg-[#004D40] text-white font-semibold py-2 px-4 rounded-lg hover:bg-[#003B2E] transition-colors duration-300">Copy to Clipboard</button>
                    <button id="close-modal-btn" class="bg-gray-200 text-gray-800 font-semibold py-2 px-4 rounded-lg hover:bg-gray-300 transition-colors duration-300">Close</button>
                </div>
            </div>
        </div>

    </main>

    <footer class="bg-gray-800 text-white py-8">
        <div class="container mx-auto px-6 text-center">
            <p>&copy; 2025 Therapeutics Inc. All rights reserved.</p>
            <p class="text-sm text-gray-400 mt-2">Northeast Donor Program Strategic Blueprint</p>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            
            const strategyData = {
                manipur: {
                    name: 'Manipur',
                    phase: 'Primary Hub (Phase 1)',
                    title: 'Elite Talent & World-Class Infrastructure',
                    description: 'Imphal is a premier target, hosting the National Sports University (NSU) and a major SAI Regional Centre. These institutions represent a concentrated population of disciplined, high-level athletes, making them the most efficient and high-yield targets for a pilot program.',
                    sports: ['Boxing', 'Weightlifting', 'Archery', 'Martial Arts'],
                    institutions: ['National Sports University (NSU)', 'SAI NERC, Imphal', 'Sai Boxing Academy']
                },
                assam: {
                    name: 'Assam',
                    phase: 'Primary Hub (Phase 1)',
                    title: 'Logistical Hub with a Broad Donor Pool',
                    description: 'Guwahati serves as a vital logistical and operational hub for the entire region. It hosts a major SAI centre and boasts numerous private and government academies, particularly for football and martial arts, offering a broad, accessible donor pool.',
                    sports: ['Football', 'Martial Arts', 'Cricket'],
                    institutions: ['SAI Regional Centre, Guwahati', 'Panjabari Sports Academy', 'Rising Stars Football Academy']
                },
                mizoram: {
                    name: 'Mizoram',
                    phase: 'Secondary Hub (Phase 2)',
                    title: 'Passionate Grassroots Football Culture',
                    description: 'Aizawl has a deeply passionate football culture, providing a clear entry point to a dedicated athletic community. The state\'s cuisine also emphasizes nutritive value and minimal oil, aligning perfectly with the program\'s dietary criteria.',
                    sports: ['Football'],
                    institutions: ['Aizawl Football Club', 'Chawngthu Sports Complex']
                },
                nagaland: {
                    name: 'Nagaland',
                    phase: 'Secondary Hub (Phase 2)',
                    title: 'Strong Community-Led Sporting Initiatives',
                    description: 'Nagaland offers a promising avenue with its strong grassroots sporting community, particularly in football and traditional games. Engaging with local academies in Kohima can provide valuable data on the broader athletic population.',
                    sports: ['Football', 'Volleyball', 'Boxing'],
                    institutions: ['Achievers Academy', 'Raw Combat Sports']
                }
            };

            const timelineData = [
                {
                    title: 'Weeks 1-2: Imphal, Manipur',
                    content: 'Establish operational hub. Conduct initial meetings with NSU and SAI NERC leadership to secure institutional buy-in. Begin on-site screenings with the most concentrated donor pools.'
                },
                {
                    title: 'Weeks 3-4: Guwahati, Assam',
                    content: 'Relocate core team to the regional hub. Expand screening program to the SAI Regional Centre and prominent private academies to broaden the donor pool across more disciplines.'
                },
                {
                    title: 'Weeks 5-6: Aizawl & Kohima',
                    content: 'Conduct focused, short-term expeditions from the Guwahati hub. Prioritize engagement with local football clubs in Aizawl and grassroots sports organizations in Kohima as a proof-of-concept for community-level recruitment.'
                }
            ];

            const academiesData = [
                { name: "Panjabari Sports Academy", address: "Panjabari, Guwahati", state: "Assam", sports: "Multiple", notes: "4.5/5 (14 ratings)" },
                { name: "Rising Dragon Club", address: "Basistha Chariali, Guwahati", state: "Assam", sports: "Multiple", notes: "4.5/5 (4 ratings)" },
                { name: "Sai Boxing Academy", address: "Imphal, Lamphelpat", state: "Manipur", sports: "Boxing", notes: "4.1/5 (67 ratings)" },
                { name: "Takyel Taekwondo Academy", address: "Imphal, Takyel Road", state: "Manipur", sports: "Taekwondo", notes: "No rating" },
                { name: "Aizawl Football Club", address: "A-77 Chanmari, Aizawl", state: "Mizoram", sports: "Football", notes: "4.4/5 (40 ratings)" },
                { name: "Chawngthu Sports", address: "Upper Bazar, Aizawl", state: "Mizoram", sports: "Multiple", notes: "Focus on sports goods" },
                { name: "Achievers Academy", address: "Kohima, P.R. Hill", state: "Nagaland", sports: "Volleyball", notes: "5/5 (4 ratings)" },
                { name: "Xlred Cricket Coaching Academy", address: "Lerie Colony, Kohima", state: "Nagaland", sports: "Cricket", notes: "4.4/5 (8 ratings)" },
                { name: "Raw Combat Sports", address: "Raj Bhavan Rd, Kohima", state: "Nagaland", sports: "Boxing", notes: "4.7/5 (82 ratings)" },
                { name: "Nabajyoti Cricket Coaching Center", address: "Jalukbari, Guwahati", state: "Assam", sports: "Cricket", notes: "4.5/5 (27 ratings)" },
                { name: "Newell Football Coaching Center", address: "Mirza, Kamrup", state: "Assam", sports: "Football", notes: "4.4/5 (10 ratings)" },
                { name: "Noonmati Wushu Training Centre", address: "Noonmati, Guwahati", state: "Assam", sports: "Wushu", notes: "5/5 (11 ratings)" }
            ];

            function populateStrategyContent(stateKey) {
                const data = strategyData[stateKey];
                const container = document.getElementById('strategy-details');
                container.innerHTML = `
                    <span class="text-sm font-semibold text-[#004D40] bg-[#D4AF37]/20 px-3 py-1 rounded-full">${data.phase}</span>
                    <h4 class="text-2xl font-bold text-gray-800 mt-4 mb-2">${data.name}: ${data.title}</h4>
                    <p class="text-gray-600 mb-6">${data.description}</p>
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                        <div>
                            <h5 class="font-semibold text-gray-700 mb-2">Target Sports</h5>
                            <ul class="list-disc list-inside text-gray-600 space-y-1">
                                ${data.sports.map(sport => `<li>${sport}</li>`).join('')}
                            </ul>
                        </div>
                        <div>
                            <h5 class="font-semibold text-gray-700 mb-2">Key Institutions</h5>
                            <ul class="list-disc list-inside text-gray-600 space-y-1">
                                ${data.institutions.map(inst => `<li>${inst}</li>`).join('')}
                            </ul>
                        </div>
                    </div>
                `;
            }

            const stateSelectorContainer = document.getElementById('state-selector-container');
            Object.keys(strategyData).forEach(key => {
                const data = strategyData[key];
                const button = document.createElement('button');
                button.className = 'state-selector w-full text-left p-4 rounded-lg bg-white shadow-sm hover:bg-gray-50 transition-all duration-300 border border-gray-200';
                button.dataset.state = key;
                button.innerHTML = `<h5 class="font-bold text-lg">${data.name}</h5><p class="text-sm text-gray-500">${data.phase}</p>`;
                stateSelectorContainer.appendChild(button);
            });

            stateSelectorContainer.addEventListener('click', function(e) {
                const selector = e.target.closest('.state-selector');
                if (selector) {
                    const stateKey = selector.dataset.state;
                    populateStrategyContent(stateKey);
                    document.querySelectorAll('.state-selector').forEach(btn => btn.classList.remove('active'));
                    selector.classList.add('active');
                }
            });

            document.querySelector('.state-selector').click();
            
            const timelineContainer = document.getElementById('timeline-container');
            timelineData.forEach(item => {
                const div = document.createElement('div');
                div.className = 'timeline-item relative pl-8 pb-8 cursor-pointer';
                div.innerHTML = `
                    <div class="p-4 bg-white rounded-lg shadow-md">
                        <h5 class="font-semibold text-gray-800">${item.title}</h5>
                        <div class="timeline-content hidden mt-2 text-gray-600 text-sm">
                            <p>${item.content}</p>
                        </div>
                    </div>
                `;
                timelineContainer.appendChild(div);
            });

            timelineContainer.addEventListener('click', function(e) {
                const item = e.target.closest('.timeline-item');
                if (item) {
                    const content = item.querySelector('.timeline-content');
                    content.classList.toggle('hidden');
                }
            });

            const tableBody = document.getElementById('academies-table-body');
            const stateFilter = document.getElementById('state-filter');
            const sportFilter = document.getElementById('sport-filter');
            
            const states = [...new Set(academiesData.map(a => a.state))].sort();
            const sports = [...new Set(academiesData.map(a => a.sports))].sort();

            states.forEach(s => stateFilter.innerHTML += `<option value="${s}">${s}</option>`);
            sports.forEach(s => sportFilter.innerHTML += `<option value="${s}">${s}</option>`);

            function renderTable(filteredData) {
                tableBody.innerHTML = '';
                if (filteredData.length === 0) {
                    tableBody.innerHTML = `<tr><td colspan="5" class="text-center px-6 py-4">No academies found for the selected criteria.</td></tr>`;
                    return;
                }
                filteredData.forEach(academy => {
                    const city = academy.address.split(', ')[1];
                    tableBody.innerHTML += `
                        <tr class="bg-white border-b hover:bg-gray-50">
                            <th scope="row" class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap">${academy.name}</th>
                            <td class="px-6 py-4">${academy.state}</td>
                            <td class="px-6 py-4">${academy.sports}</td>
                            <td class="px-6 py-4">${city}</td>
                            <td class="px-6 py-4 text-center">
                                <button class="generate-email-btn bg-[#D4AF37] text-gray-900 px-3 py-1 rounded-lg hover:bg-[#B79930] transition-colors duration-300 text-xs font-semibold" data-name="${academy.name}" data-state="${academy.state}" data-sports="${academy.sports}">Generate Email</button>
                            </td>
                        </tr>
                    `;
                });
            }

            function filterData() {
                const selectedState = stateFilter.value;
                const selectedSport = sportFilter.value;
                
                const filtered = academiesData.filter(academy => {
                    const stateMatch = selectedState === 'All' || academy.state === selectedState;
                    const sportMatch = selectedSport === 'All' || academy.sports.includes(selectedSport);
                    return stateMatch && sportMatch;
                });
                renderTable(filtered);
            }

            stateFilter.addEventListener('change', filterData);
            sportFilter.addEventListener('change', filterData);
            renderTable(academiesData);

            const ctx = document.getElementById('sportsChart').getContext('2d');
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Manipur', 'Assam', 'Mizoram', 'Nagaland'],
                    datasets: [{
                        label: 'Weightlifting/Boxing/Martial Arts',
                        data: [10, 6, 2, 5],
                        backgroundColor: '#004D40',
                    }, {
                        label: 'Football',
                        data: [7, 8, 10, 9],
                        backgroundColor: '#D4AF37',
                    }, {
                        label: 'Archery',
                        data: [8, 3, 1, 1],
                        backgroundColor: '#4A5568',
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            stacked: true,
                        },
                        y: {
                            stacked: true,
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Relative Prominence Score'
                            }
                        }
                    },
                    plugins: {
                        title: {
                            display: true,
                            text: 'Prominence of Target Sports by State'
                        },
                        tooltip: {
                            mode: 'index',
                            intersect: false
                        }
                    }
                }
            });

            const mobileNav = document.getElementById('mobile-nav');
            mobileNav.addEventListener('change', (e) => {
                window.location.hash = e.target.value;
            });

            const insightPromptInput = document.getElementById('insight-prompt');
            const generateInsightBtn = document.getElementById('generate-insight-btn');
            const insightOutputDiv = document.getElementById('insight-output');
            const insightLoading = document.getElementById('insight-loading');
            
            async function callGeminiApi(prompt, retries = 3, delay = 1000) {
                insightLoading.classList.remove('hidden');
                insightOutputDiv.innerHTML = '';
                let chatHistory = [];
                chatHistory.push({ role: "user", parts: [{ text: prompt }] });
                const payload = { contents: chatHistory };
                const apiKey = ""
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

                for (let i = 0; i < retries; i++) {
                    try {
                        const response = await fetch(apiUrl, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(payload)
                        });

                        if (response.status === 429) {
                            if (i < retries - 1) {
                                await new Promise(res => setTimeout(res, delay));
                                delay *= 2;
                                continue;
                            } else {
                                throw new Error('API request failed after multiple retries.');
                            }
                        }

                        const result = await response.json();
                        if (result.candidates && result.candidates.length > 0 && result.candidates[0].content && result.candidates[0].content.parts && result.candidates[0].content.parts.length > 0) {
                            insightLoading.classList.add('hidden');
                            return result.candidates[0].content.parts[0].text;
                        } else {
                            throw new Error('Unexpected API response structure.');
                        }
                    } catch (error) {
                        insightLoading.classList.add('hidden');
                        insightOutputDiv.innerHTML = `<p class="text-red-500">Error: ${error.message}</p>`;
                        return null;
                    }
                }
                insightLoading.classList.add('hidden');
                insightOutputDiv.innerHTML = `<p class="text-red-500">API request failed after multiple retries.</p>`;
                return null;
            }

            generateInsightBtn.addEventListener('click', async () => {
                const userPrompt = insightPromptInput.value.trim();
                if (!userPrompt) {
                    insightOutputDiv.innerHTML = `<p class="text-red-500">Please enter a question or idea to generate.</p>`;
                    return;
                }
                const prompt = `You are an expert on health, diet, and sports in Northeast India. A project manager for a therapeutics company is planning a donor program to find "super donors" among athletes with specific dietary habits (home-cooked, low processed food) and a history of athleticism. The current program focuses on Manipur, Assam, Mizoram, and Nagaland. Given the following request, provide strategic insights. Be concise and professional. The request is: "${userPrompt}"`;
                const insight = await callGeminiApi(prompt);
                if (insight) {
                    insightOutputDiv.innerHTML = `<pre class="whitespace-pre-wrap">${insight}</pre>`;
                }
            });

            const emailModal = document.getElementById('email-modal');
            const closeModalBtn = document.getElementById('close-modal-btn');
            const emailDraftTextarea = document.getElementById('email-draft');
            const generateEmailBtn = document.getElementById('generate-email-btn');
            const emailLoading = document.getElementById('email-loading');
            const contactNameInput = document.getElementById('contact-name');
            const customNotesTextarea = document.getElementById('custom-notes');
            const copyEmailBtn = document.getElementById('copy-email-btn');

            document.addEventListener('click', function(e) {
                if (e.target.classList.contains('generate-email-btn')) {
                    const academyName = e.target.dataset.name;
                    const academyState = e.target.dataset.state;
                    const academySports = e.target.dataset.sports;
                    emailModal.classList.remove('hidden');
                    emailModal.classList.add('flex');
                    emailDraftTextarea.value = 'Draft will appear here...';
                    contactNameInput.value = '';
                    customNotesTextarea.value = '';
                    
                    document.getElementById('generate-email-btn').onclick = async () => {
                        emailLoading.classList.remove('hidden');
                        const contactName = contactNameInput.value;
                        const customNotes = customNotesTextarea.value;
                        const prompt = `Draft a professional and concise outreach email to a sports academy. The purpose is to introduce our company, Therapeutics Inc., and our "Super Donor" program, which seeks to find individuals with exceptional gut microbiomes. Mention that we are targeting athletes who have home-cooked, low processed food diets and an athletic lifestyle. The recipient is the ${academyName} in ${academyState}, which focuses on ${academySports}. If a contact person name is provided ("${contactName}"), address the email to them. If custom notes are provided ("${customNotes}"), incorporate them professionally into the body of the email. Keep it under 200 words.`;
                        try {
                            const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=`, {
                                method: 'POST',
                                headers: { 'Content-Type': 'application/json' },
                                body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] })
                            });

                            if (!response.ok) {
                                throw new Error('API request failed.');
                            }
                            const result = await response.json();
                            if (result.candidates && result.candidates.length > 0 && result.candidates[0].content && result.candidates[0].content.parts && result.candidates[0].content.parts.length > 0) {
                                emailDraftTextarea.value = result.candidates[0].content.parts[0].text;
                            } else {
                                emailDraftTextarea.value = 'Error generating draft: Unexpected API response.';
                            }
                        } catch (error) {
                            emailDraftTextarea.value = `Error generating draft: ${error.message}`;
                        } finally {
                            emailLoading.classList.add('hidden');
                        }
                    };
                }
            });

            closeModalBtn.addEventListener('click', () => {
                emailModal.classList.add('hidden');
            });

            copyEmailBtn.addEventListener('click', () => {
                emailDraftTextarea.select();
                emailDraftTextarea.setSelectionRange(0, 99999);
                document.execCommand('copy');
                copyEmailBtn.textContent = 'Copied!';
                setTimeout(() => {
                    copyEmailBtn.textContent = 'Copy to Clipboard';
                }, 2000);
            });
        });
    </script>
</body>
</html>
